<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventur‚ÄëCheck ¬∑ Admin</title>
  <style>
    :root{
      --bg:#0b1220;--card:#111a2b;--muted:#8aa0c7;--text:#e6eeff;--accent:#64b5f6;--ok:#22c55e;--warn:#eab308;--danger:#ef4444;
      --ring:#1d4ed8
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 20% -10%,#173057 0%,transparent 60%),
               radial-gradient(1000px 700px at 120% 10%,#10213d 0%,transparent 50%),
               var(--bg);
         color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;}
    .container{max-width:980px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:16px}
    @media(min-width:768px){.grid-cols-2{grid-template-columns:1fr 1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
          border:1px solid rgba(148,163,184,.18);border-radius:16px;padding:18px}
    .title{font-size:28px;font-weight:800;line-height:1.1;margin:8px 0 2px}
    .subtitle{color:var(--muted);margin:0 0 18px}
    label{font-weight:600;font-size:14px;display:block;margin:8px 0 6px}
    input[type="text"], input[type="datetime-local"], textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.26);background:#0d1424;color:var(--text);outline:none}
    textarea{min-height:88px;resize:vertical}
    input:focus, textarea:focus{border-color:var(--ring);box-shadow:0 0 0 3px rgba(29,78,216,.35)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid rgba(148,163,184,.26);background:#111a2b;color:var(--text);
         padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .btn.primary{background:linear-gradient(180deg,#2563eb,#1d4ed8);border-color:#1e40af}
    .btn.ghost{background:transparent}
    .btn.success{background:linear-gradient(180deg,#16a34a,#15803d);border-color:#166534}
    .btn.warn{background:linear-gradient(180deg,#f59e0b,#d97706);border-color:#b45309;color:#111}
    .btn.danger{background:linear-gradient(180deg,#ef4444,#dc2626)}
    .muted{color:var(--muted);font-size:13px}
    .preview{font-variant-numeric:tabular-nums;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;background:#0e1628;border:1px solid rgba(148,163,184,.18)}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(148,163,184,.25),transparent);margin:12px 0}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .kbd{border:1px solid rgba(148,163,184,.35);padding:2px 6px;border-radius:6px;background:#0b1322}
    .footer{opacity:.8;font-size:12px}
    .link{color:var(--accent);text-decoration:none}
    .link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="container">
    <div class="title">Inventur‚ÄëCheck ¬∑ Admin</div>
    <p class="subtitle">Verwalte Startzeit, Texte und teile die Konfiguration mit dem Team. Alle Daten werden lokal im Browser gespeichert (localStorage). Optional kannst du eine <span class="mono">config</span>‚ÄëURL erzeugen.</p>

    <div class="grid grid-cols-2">
      <section class="card">
        <h2>üîß Einstellungen</h2>
        <div class="divider"></div>
        <label for="start">Start (Datum & Uhrzeit)</label>
        <input id="start" type="datetime-local" />
        <p class="muted">Zeitzone: <strong>Europe/Berlin</strong>. Beispiel aus eurer Vorgabe: <em>14.11. 14:15 Uhr</em>.</p>

        <label for="end">Ende (optional)</label>
        <input id="end" type="datetime-local" />
        <p class="muted">Nur f√ºr Info/Countdown‚ÄëAnzeige bis Ende. Lass frei, wenn nicht ben√∂tigt.</p>

        <label for="preText">Text vor Start</label>
        <textarea id="preText" placeholder="Die Inventur beginnt am 14.11. um 14:15 Uhr."></textarea>

        <label for="liveText">Text nach Start</label>
        <textarea id="liveText" placeholder="Die Inventur ist gestartet."></textarea>

        <label for="info">Zusatzinfo (optional)</label>
        <textarea id="info" placeholder="Die Inventur findet garantiert statt bis zur Sp√§tschicht am 15.11.; Nachtschicht 15./16. entf√§llt. Sonntag Fr√ºh 16.11. nicht."></textarea>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="saveBtn">Speichern</button>
          <button class="btn ghost" id="loadBtn" title="Zuletzt gespeicherte Daten laden">Laden</button>
          <button class="btn warn" id="resetBtn" title="Formular zur√ºcksetzen">Zur√ºcksetzen</button>
        </div>

        <div class="divider"></div>
        <h3>üì¶ Import/Export</h3>
        <div class="row">
          <button class="btn" id="exportBtn">Export JSON</button>
          <button class="btn" id="importBtn">Import JSON</button>
          <input id="fileInput" type="file" accept="application/json" style="display:none" />
        </div>

        <p class="muted" style="margin-top:8px">Ablage‚ÄëSchl√ºssel: <span class="mono" id="storageKey">inventurCheckConfigV2</span></p>
      </section>

      <section class="card">
        <h2>üëÄ Vorschau</h2>
        <div class="divider"></div>
        <div id="status" class="pill">Status: ‚Äì</div>
        <div style="height:8px"></div>
        <div id="countdown" class="preview mono">‚Äì</div>
        <div style="height:8px"></div>
        <div id="previewText" class="mono"></div>
        <div style="height:8px"></div>
        <div id="previewInfo" class="muted"></div>

        <div class="divider"></div>
        <h3>üîó Public Link</h3>
        <p class="muted">Erzeuge eine URL mit Query‚ÄëParam <span class="mono">?config=...</span> (Base64‚ÄëJSON). Deine <span class="mono">index.html</span> muss diese optional auslesen.</p>
        <div class="row">
          <button class="btn success" id="linkBtn">Link erzeugen & kopieren</button>
          <a class="btn" id="openBtn" href="#" target="_blank" rel="noopener">√ñffnen</a>
        </div>
        <p class="muted" id="linkOut" style="word-break:break-all"></p>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h2>‚ÑπÔ∏è Hinweise</h2>
      <div class="divider"></div>
      <ul>
        <li>Speichern legt die Daten lokal im Browser ab. Deployment √ºber GitHub Pages: einfach diese <span class="mono">admin.html</span> in dein Repo legen.</li>
        <li>Die Vorschau zeigt live, was Besucher auf der Startseite sehen k√∂nnten. Nach Startzeit wechselt der Status automatisch auf <em>gestartet</em>.</li>
        <li>Optional: Erzeuge den Public‚ÄëLink und verteile ihn im Team‚ÄëChat.</li>
      </ul>
    </section>

    <p class="footer">Made for Kevin ¬∑ Admin Oberfl√§che f√ºr den Inventur‚ÄëCheck. Shortcut: <span class="kbd">Ctrl</span> + <span class="kbd">S</span> speichert.</p>
  </div>

  <script>
    const $ = (q)=>document.querySelector(q);
    const els = {
      start: $('#start'), end: $('#end'), preText: $('#preText'), liveText: $('#liveText'), info: $('#info'),
      saveBtn: $('#saveBtn'), loadBtn: $('#loadBtn'), resetBtn: $('#resetBtn'),
      exportBtn: $('#exportBtn'), importBtn: $('#importBtn'), fileInput: $('#fileInput'),
      status: $('#status'), countdown: $('#countdown'), previewText: $('#previewText'), previewInfo: $('#previewInfo'),
      linkBtn: $('#linkBtn'), linkOut: $('#linkOut'), openBtn: $('#openBtn'), storageKey: $('#storageKey')
    };

    const STORAGE_KEY = 'inventurCheckConfigV2';

    function toISOLocal(dt){
      if(!dt) return '';
      const pad = (n)=>String(n).padStart(2,'0');
      return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}T${pad(dt.getHours())}:${pad(dt.getMinutes())}`;
    }

    function fromInput(v){
      if(!v) return null;
      // Treat as local time Europe/Berlin
      const t = v.trim();
      const [dPart, hPart] = t.split('T');
      const [y,m,d] = dPart.split('-').map(Number);
      const [hh,min] = (hPart||'00:00').split(':').map(Number);
      return new Date(y, m-1, d, hh, min, 0, 0);
    }

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      try{
        const cfg = JSON.parse(raw);
        els.start.value = cfg.start ? toISOLocal(new Date(cfg.start)) : '';
        els.end.value = cfg.end ? toISOLocal(new Date(cfg.end)) : '';
        els.preText.value = cfg.preText||'';
        els.liveText.value = cfg.liveText||'';
        els.info.value = cfg.info||'';
        render();
      }catch(e){ console.error('LOAD', e); }
    }

    function save(){
      const cfg = currentConfig();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
      toast('Gespeichert.');
    }

    function resetForm(){
      els.start.value = '';
      els.end.value = '';
      els.preText.value = '';
      els.liveText.value = '';
      els.info.value = '';
      render();
    }

    function currentConfig(){
      return {
        start: els.start.value ? fromInput(els.start.value).toISOString() : null,
        end: els.end.value ? fromInput(els.end.value).toISOString() : null,
        preText: els.preText.value.trim(),
        liveText: els.liveText.value.trim(),
        info: els.info.value.trim(),
        tz: 'Europe/Berlin',
        v: 2
      };
    }

    function exportJSON(){
      const cfg = currentConfig();
      const blob = new Blob([JSON.stringify(cfg,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'inventur-config.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    function importJSON(){ els.fileInput.click(); }

    els.fileInput.addEventListener('change', async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      try{
        const text = await f.text();
        const cfg = JSON.parse(text);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
        load();
        toast('Importiert.');
      }catch(err){ toast('Import fehlgeschlagen.', true); }
      finally{ e.target.value = '' }
    });

    let timer = null;
    function render(){
      if(timer) { clearInterval(timer); timer = null; }
      const cfg = currentConfig();
      const now = new Date();
      const start = cfg.start ? new Date(cfg.start) : null;
      const end = cfg.end ? new Date(cfg.end) : null;

      const status = (!start) ? 'fehlende Startzeit' : (now < start ? 'wartet' : 'gestartet');
      els.status.textContent = `Status: ${status}`;
      els.status.style.background = status === 'gestartet' ? 'linear-gradient(180deg,#16a34a,#15803d)' : '#0e1628';

      function fmt(ms){
        const sec = Math.max(0, Math.floor(ms/1000));
        const d = Math.floor(sec/86400);
        const h = Math.floor((sec%86400)/3600);
        const m = Math.floor((sec%3600)/60);
        const s = sec%60;
        return `${String(d).padStart(2,'0')}d : ${String(h).padStart(2,'0')}h : ${String(m).padStart(2,'0')}m : ${String(s).padStart(2,'0')}s`;
      }

      function updateCountdown(){
        const now = new Date();
        if(start && now < start){
          els.countdown.textContent = `Countdown bis Start: ${fmt(start-now)}`;
          els.previewText.textContent = cfg.preText || '‚Äî';
        } else if(end && now < end){
          els.countdown.textContent = `L√§uft‚Ä¶ Restzeit bis Ende: ${fmt(end-now)}`;
          els.previewText.textContent = cfg.liveText || 'Die Inventur ist gestartet.';
        } else if(end && now >= end){
          els.countdown.textContent = 'Beendet';
          els.previewText.textContent = cfg.liveText || 'Die Inventur ist gestartet.';
        } else {
          els.countdown.textContent = start ? 'Gestartet' : '‚Äî';
          els.previewText.textContent = (start ? (cfg.liveText||'Die Inventur ist gestartet.') : (cfg.preText||'‚Äî'));
        }
        els.previewInfo.textContent = cfg.info || '';
      }

      updateCountdown();
      timer = setInterval(updateCountdown, 1000);
    }

    function toast(msg, isErr){
      const t = document.createElement('div');
      t.textContent = msg; t.style.position='fixed'; t.style.bottom='18px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
      t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex='9999';
      t.style.background = isErr ? 'linear-gradient(180deg,#ef4444,#dc2626)' : 'linear-gradient(180deg,#2563eb,#1d4ed8)';
      t.style.border='1px solid rgba(255,255,255,.2)';
      document.body.appendChild(t);
      setTimeout(()=>t.remove(), 1800);
    }

    function makeLink(){
      const cfg = currentConfig();
      const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(cfg))));
      const url = new URL(window.location.href);
      // Replace filename with index.html if present
      const parts = url.pathname.split('/');
      parts[parts.length-1] = 'index.html';
      url.pathname = parts.join('/');
      url.search = `?config=${b64}`;
      return url.toString();
    }

    // Events
    [els.start, els.end, els.preText, els.liveText, els.info].forEach(el=>{
      el.addEventListener('input', render);
    });

    els.saveBtn.addEventListener('click', save);
    els.loadBtn.addEventListener('click', load);
    els.resetBtn.addEventListener('click', ()=>{ resetForm(); toast('Zur√ºckgesetzt.'); });
    els.exportBtn.addEventListener('click', exportJSON);
    els.importBtn.addEventListener('click', importJSON);

    els.linkBtn.addEventListener('click', ()=>{
      const link = makeLink();
      els.linkOut.textContent = link;
      navigator.clipboard?.writeText(link).then(()=>toast('Link kopiert.')).catch(()=>toast('Konnte nicht kopieren', true));
      els.openBtn.href = link;
    });

    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); save(); }
    });

    // Initial
    load();
    render();
  </script>
</body>
</html>
