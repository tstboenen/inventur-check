<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventur-Check – Früh / Spät / Nacht</title>
  <style>
    :root {
      --ok:#16a34a; --no:#dc2626; --warn:#f59e0b;
      --bg:#0b1020; --card:#111827; --ink:#e5e7eb; --muted:#9ca3af; --ring:#374151;
      --brand:#00aeef;
    }
    @media (prefers-color-scheme: light) {
      :root {--bg:#f8fafc;--card:#fff;--ink:#111827;--muted:#6b7280;--ring:#e5e7eb;}
    }
    body {margin:0;font-family:system-ui,Roboto,sans-serif;background:var(--bg);color:var(--ink);}
    .wrap{max-width:900px;margin:auto;padding:24px}
    h1{margin:0 0 8px;font-size:clamp(1.5rem,1rem+2vw,2.2rem)}
    .sub{margin:0 0 24px;color:var(--muted)}
    .grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .card h2{margin:0 0 8px}
    .badge{display:inline-block;padding:10px 14px;border-radius:10px;font-weight:600}
    .ok{background:var(--ok);color:#fff}
    .no{background:var(--no);color:#fff}
    .warn{background:var(--warn);color:#111}
    .hint{margin-top:12px;color:var(--muted);font-size:.9rem}
    #countdown{font-family:monospace;font-size:1.4rem;color:var(--brand)}
    .footer{margin-top:32px;text-align:center;color:var(--muted);font-size:.9rem}
    a.btn{display:inline-block;margin-top:12px;background:var(--brand);color:#fff;text-decoration:none;padding:10px 14px;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Inventur-Check</h1>
    <p class="sub">Zeigt, welche Schicht zur Inventur erscheinen muss.</p>

    <div id="banner" class="card" style="text-align:center;">
      <div><strong>Inventur-Start:</strong> 14. 11. 2025 – 14:15 Uhr</div>
      <div id="countdown">– : – : –</div>
    </div>

    <main id="main" class="grid"></main>

    <div class="footer">
      <p>Aktuelle Daten aus <code>rules.json</code> – TST Bönen</p>
      <a class="btn" href="admin.html">⚙️ Admin-Bereich</a>
    </div>
  </div>

<script>
const CONFIG = {
  startISO: "2025-11-14T14:15:00+01:00",
  repoRaw: "https://raw.githubusercontent.com/tstboenen/inventur-check/main/rules.json",
  timezone: "Europe/Berlin"
};
function pad(n){return String(n).padStart(2,"0")}
function formatDHMS(ms){const s=Math.max(0,Math.floor(ms/1000));const h=Math.floor(s/3600),m=Math.floor(s%3600/60),sec=s%60;return `${pad(h)}:${pad(m)}:${pad(sec)}`}
function updateCountdown(){const now=new Date(),target=new Date(CONFIG.startISO),diff=target-now;document.getElementById("countdown").textContent=diff>0?formatDHMS(diff):"✅ Inventur gestartet";}
function renderStatus(data){
  const now=new Date();
  const y=now.getFullYear(),m=String(now.getMonth()+1).padStart(2,"0"),d=String(now.getDate()).padStart(2,"0");
  const today=`${y}-${m}-${d}`;
  const rule=data.rules.find(r=>today>=r.start&&today<= (r.end||r.start));
  const main=document.getElementById("main");
  if(!rule){main.innerHTML='<p>Keine Daten für heute.</p>';return;}
  const shifts=[["frueh","Frühschicht","05:30–14:00"],["spaet","Spätschicht","14:15–22:00"],["nacht","Nachtschicht","20:45–05:30"]];
  main.innerHTML=shifts.map(([key,label,time])=>{
    const yes=rule[key];const cls=yes?"ok":"no";const icon=yes?"✅":"❌";
    return `<section class='card'><h2>${label}</h2><div class='badge ${cls}'>${icon} ${yes?"MUSS":"MUSS NICHT"} kommen</div><div class='hint'>${time}</div></section>`;
  }).join('');
}
async function loadData(){
  try{
    const r=await fetch(CONFIG.repoRaw,{cache:"no-store"});
    const j=await r.json();
    renderStatus(j);
  }catch(e){
    document.getElementById("main").innerHTML="<p style='color:red'>Fehler beim Laden der Daten.</p>";
  }
}
setInterval(updateCountdown,1000);
updateCountdown();
loadData();
</script>
</body>
</html>
